{
  "type": "vector.function",
  "description": "Analyze the narrative structure of a startup pitch, returning a 7-dimensional probability distribution across canonical pitch elements: Problem, Solution, Market, Business Model, Traction/Proof, Team/Execution, and Vision. The scores represent relative narrative weight devoted to each element, summing to 1.",
  "input_schema": {
    "type": "object",
    "description": "A startup pitch to analyze for narrative coherence across the seven canonical elements: Problem, Solution, Market, Business Model, Traction, Team, and Vision.",
    "properties": {
      "idea": {
        "anyOf": [
          {
            "type": "string",
            "description": "A text-based startup pitch (elevator pitch, executive summary, pitch script, etc.)"
          },
          {
            "type": "image",
            "description": "An image-based pitch (pitch deck slide, infographic, one-pager)"
          },
          {
            "type": "audio",
            "description": "An audio pitch (recorded elevator pitch, podcast clip)"
          },
          {
            "type": "video",
            "description": "A video pitch (demo day recording, pitch video, product demo)"
          },
          {
            "type": "array",
            "description": "A composite pitch containing multiple elements (e.g., pitch deck slides + founder video)",
            "minItems": 1,
            "items": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "image"
                },
                {
                  "type": "audio"
                },
                {
                  "type": "video"
                }
              ]
            }
          }
        ]
      }
    },
    "required": [
      "idea"
    ]
  },
  "input_maps": [
    {
      "$starlark": "[{'index': i, 'name': ['PROBLEM', 'SOLUTION', 'MARKET', 'BUSINESS MODEL', 'TRACTION', 'TEAM', 'VISION'][i], 'criteria': ['Is the problem explicitly stated, specific, significant, urgent, and emotionally resonant? Is there validation evidence?', 'Is the solution clearly described, understandable, differentiated, feasible, and does it fit the problem?', 'Is market size quantified (TAM/SAM/SOM), methodology credible, growth discussed, competitive landscape acknowledged, segments identified?', 'Is the revenue model clear, pricing specified, unit economics discussed, model scalable, path to profitability shown?', 'Are metrics quantified, growth velocity shown, quality meaningful, third-party validations present?', 'Are backgrounds presented, domain expertise shown, track record demonstrated, team complete, why-us argument made?', 'Is vision articulated beyond immediate product, ambitious, credible, connected to current work, impact-focused?'][i]} for i in (input.get('_element_indices', range(7)) if hasattr(input, 'get') else input['_element_indices'] if '_element_indices' in input else range(7))]"
    }
  ],
  "tasks": [
    {
      "type": "vector.completion",
      "map": 0,
      "messages": [
        {
          "role": "system",
          "content": [
            {
              "type": "text",
              "text": {
                "$starlark": "'You are an expert startup pitch analyst evaluating the ' + map['name'] + ' element in startup pitches.\\n\\nEvaluation Criteria: ' + map['criteria'] + '\\n\\nRate how much narrative weight is devoted to this element. Choose the single best answer.'"
              }
            }
          ]
        },
        {
          "role": "user",
          "content": {
            "$starlark": "[{'type': 'text', 'text': 'Evaluate the ' + map['name'] + ' element in this startup pitch:'}] + ([{'type': 'text', 'text': input['idea']}] if type(input['idea']) == 'string' else [input['idea']] if type(input['idea']) != 'list' else [({'type': 'text', 'text': x} if type(x) == 'string' else x) for x in input['idea']])"
          }
        }
      ],
      "responses": [
        {
          "$starlark": "[{'type': 'text', 'text': 'Dominant ' + map['name'] + ': This element dominates the pitch with extensive detail and compelling articulation'}]"
        },
        {
          "$starlark": "[{'type': 'text', 'text': 'Strong ' + map['name'] + ': This element is clearly and thoroughly addressed'}]"
        },
        {
          "$starlark": "[{'type': 'text', 'text': 'Moderate ' + map['name'] + ': This element is present but could be stronger or more detailed'}]"
        },
        {
          "$starlark": "[{'type': 'text', 'text': 'Light ' + map['name'] + ': This element is mentioned briefly or only implied'}]"
        },
        {
          "$starlark": "[{'type': 'text', 'text': 'Absent ' + map['name'] + ': This element is not articulated in the pitch'}]"
        }
      ],
      "output": {
        "$starlark": "(lambda scores, total: [s / total if total > 0 else 1.0 / len(scores) for s in scores])([output[i]['scores'][0] * 4.0 + output[i]['scores'][1] * 3.0 + output[i]['scores'][2] * 2.0 + output[i]['scores'][3] * 1.0 + output[i]['scores'][4] * 0.0 for i in range(len(output))], sum([output[i]['scores'][0] * 4.0 + output[i]['scores'][1] * 3.0 + output[i]['scores'][2] * 2.0 + output[i]['scores'][3] * 1.0 + output[i]['scores'][4] * 0.0 for i in range(len(output))]))"
      }
    }
  ],
  "output_length": {
    "$starlark": "len(input['_element_indices']) if '_element_indices' in input else 7"
  },
  "input_split": {
    "$starlark": "[{'idea': input['idea'], '_element_indices': [i]} for i in range(7)]"
  },
  "input_merge": {
    "$starlark": "{'idea': input[0]['idea']} if len(input) == 7 else {'idea': input[0]['idea'], '_element_indices': [x for sub in input for x in sub['_element_indices']]}"
  }
}