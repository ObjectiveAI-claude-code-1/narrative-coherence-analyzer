{
  "type": "vector.function",
  "description": "Analyzes the narrative structure of a startup pitch, producing a probability distribution across seven canonical narrative elements: Problem, Solution, Market, Business Model, Traction, Team, and Vision. Each score represents the relative strength of that element in the pitch's overall narrative, with all scores summing to 1.0.",
  "input_schema": {
    "type": "object",
    "properties": {
      "idea": {
        "anyOf": [
          {
            "type": "string"
          },
          {
            "type": "image"
          },
          {
            "type": "audio"
          },
          {
            "type": "video"
          },
          {
            "type": "array",
            "minItems": 1,
            "items": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "image"
                },
                {
                  "type": "audio"
                },
                {
                  "type": "video"
                }
              ]
            }
          }
        ]
      }
    },
    "required": [
      "idea"
    ]
  },
  "input_maps": [
    {
      "$starlark": "(lambda elements, indices: [elements[i] for i in indices])([{'name': 'Problem', 'desc': 'Why should anyone care?', 'criteria': 'Specificity, Urgency, Pain Intensity, Universality, Authenticity'}, {'name': 'Solution', 'desc': 'What is the answer?', 'criteria': 'Clarity, Elegance, Differentiation, Feasibility, Problem-Solution Fit, Demonstrability'}, {'name': 'Market', 'desc': 'How big is the opportunity?', 'criteria': 'Size, Growth, Accessibility, Segmentation, Timing, Competitive Landscape'}, {'name': 'Business Model', 'desc': 'How will value be captured?', 'criteria': 'Clarity, Alignment, Defensibility, Scalability, Proven Patterns, Path to Profitability'}, {'name': 'Traction', 'desc': 'Is this working?', 'criteria': 'Quantitative Evidence, Quality of Metrics, Trend Direction, Social Proof, Milestones, Customer Testimonials'}, {'name': 'Team', 'desc': 'Who will make this happen?', 'criteria': 'Relevant Experience, Complementary Skills, Track Record, Unfair Advantages, Cohesion, Commitment'}, {'name': 'Vision', 'desc': 'Where is this going?', 'criteria': 'Ambition, Clarity, Believability, Inspiration, Coherence, Uniqueness'}], input['_indices'] if '_indices' in input else ([input['_idx']] if '_idx' in input else [0, 1, 2, 3, 4, 5, 6]))"
    }
  ],
  "tasks": [
    {
      "type": "vector.completion",
      "map": 0,
      "messages": [
        {
          "role": "system",
          "content": [
            {
              "type": "text",
              "text": {
                "$starlark": "'You are an expert startup pitch analyst. Evaluate the ' + map['name'] + ' element in this startup pitch.\\n\\nThis element answers: \"' + map['desc'] + '\"\\n\\nEvaluation criteria: ' + map['criteria'] + '\\n\\nAssess:\\n1. PRESENCE: Is this element explicitly addressed, implied, or absent?\\n2. QUALITY: If present, how compelling is the articulation?\\n3. FLOW: Does this element connect logically to the overall narrative?\\n\\nRate the overall strength of this narrative element. Choose the single best answer.'"
              }
            }
          ]
        },
        {
          "role": "user",
          "content": {
            "$starlark": "[{'type': 'text', 'text': 'Analyze the ' + map['name'] + ' element in this startup pitch:'}] + ([{'type': 'text', 'text': input['idea']}] if type(input['idea']) == 'string' else ([input['idea']] if type(input['idea']) != 'list' else [x if type(x) != 'string' else {'type': 'text', 'text': x} for x in input['idea']]))"
          }
        }
      ],
      "responses": [
        [
          {
            "type": "text",
            "text": "Exceptional: Element is compelling, thoroughly addressed with exceptional quality and seamless narrative flow"
          }
        ],
        [
          {
            "type": "text",
            "text": "Strong: Element is well-articulated, clearly addressed with good quality and narrative integration"
          }
        ],
        [
          {
            "type": "text",
            "text": "Adequate: Element is present with moderate clarity, acceptable quality and flow"
          }
        ],
        [
          {
            "type": "text",
            "text": "Weak: Element is barely present, vague or poorly articulated, weak narrative connection"
          }
        ],
        [
          {
            "type": "text",
            "text": "Absent: Element is not addressed or only barely implied"
          }
        ]
      ],
      "output": {
        "$starlark": "(lambda raw_scores, total: [s / total if total > 0.001 else 1.0 / len(raw_scores) for s in raw_scores])([o['scores'][0] * 1.0 + o['scores'][1] * 0.75 + o['scores'][2] * 0.5 + o['scores'][3] * 0.25 + o['scores'][4] * 0.05 for o in output], sum([o['scores'][0] * 1.0 + o['scores'][1] * 0.75 + o['scores'][2] * 0.5 + o['scores'][3] * 0.25 + o['scores'][4] * 0.05 for o in output]))"
      }
    }
  ],
  "output_length": {
    "$starlark": "len(input['_indices']) if '_indices' in input else (1 if '_idx' in input else 7)"
  },
  "input_split": {
    "$starlark": "[{'idea': input['idea'], '_idx': i} for i in range(7)]"
  },
  "input_merge": {
    "$starlark": "{'idea': input[0]['idea']} if len(input) == 7 else {'idea': input[0]['idea'], '_indices': [x['_idx'] for x in input]}"
  }
}