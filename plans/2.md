# Implementation Plan: Narrative Coherence Analyzer

## Overview

The **narrative-coherence-analyzer** is a `vector.function` with a fixed output length of 7 that analyzes startup pitches and returns a probability distribution across seven canonical narrative elements: Problem, Solution, Market, Business Model, Traction/Proof, Team/Execution, and Vision.

---

## Input Schema

```json
{
  "type": "object",
  "description": "A startup pitch to analyze for narrative structure and element distribution",
  "properties": {
    "idea": {
      "anyOf": [
        {
          "type": "string",
          "description": "A text-based startup pitch (email pitch, application essay, pitch script)"
        },
        {
          "type": "image",
          "description": "A visual pitch (slide deck image, infographic, one-pager)"
        },
        {
          "type": "audio",
          "description": "An audio pitch (voice memo, podcast appearance, phone pitch)"
        },
        {
          "type": "video",
          "description": "A video pitch (demo day recording, pitch competition, product walkthrough)"
        },
        {
          "type": "array",
          "description": "A composite pitch combining multiple formats (deck with voiceover, slides with transcript)",
          "items": {
            "anyOf": [
              { "type": "string" },
              { "type": "image" },
              { "type": "audio" },
              { "type": "video" }
            ]
          }
        }
      ]
    }
  },
  "required": ["idea"]
}
```

### Input Schema Notes
- Single `idea` field accepts any pitch format
- Multimodal support via `anyOf` at the field level
- Array type enables composite pitches (e.g., deck slides + transcript)
- No input maps needed since we're not doing mapped execution

---

## Input Maps

**Not required.** The function evaluates a single pitch and produces a single 7-element vector. There is no need to map over multiple items or iterate.

---

## Function Definition Structure

```json
{
  "type": "vector.function",
  "description": "Analyze the narrative structure of a startup pitch, returning a 7-dimensional probability distribution across canonical pitch elements: Problem, Solution, Market, Business Model, Traction/Proof, Team/Execution, and Vision. The scores represent relative narrative weight devoted to each element, summing to 1.",
  "input_schema": { ... },
  "output_length": 7,
  "tasks": [
    // Task 1: Problem Element Analyzer
    // Task 2: Solution Element Analyzer
    // Task 3: Market Element Analyzer
    // Task 4: Business Model Element Analyzer
    // Task 5: Traction/Proof Element Analyzer
    // Task 6: Team/Execution Element Analyzer
    // Task 7: Vision Element Analyzer
  ]
}
```

---

## Task Definitions

Each of the 7 tasks follows the same pattern: a `vector.completion` task that evaluates one narrative element's presence and weight in the pitch. Each produces a raw score from 0-4 based on a 5-level gradient.

### Task 1: Problem Element Analyzer

**Type**: `vector.completion`

**System Prompt**: Expert pitch analyst evaluating PROBLEM articulation in startup pitches. Consider explicit problem statements, validation evidence, specificity, magnitude, urgency, and "why now" framing.

**User Prompt**: `"Evaluate the PROBLEM element in this startup pitch:\n\n" + str(input['idea'])`

**Responses** (5 levels, scored 4→0):
1. "Dominant: Problem articulation is the centerpiece with extensive evidence, specificity, and emotional resonance"
2. "Strong: Problem is clearly and compellingly stated with supporting validation"
3. "Moderate: Problem is present and understandable but could be more specific or validated"
4. "Light: Problem is mentioned briefly or implied rather than developed"
5. "Absent: No discernible problem framing; pitch jumps directly to other elements"

**Output Expression**: `output['scores'][0] * 4 + output['scores'][1] * 3 + output['scores'][2] * 2 + output['scores'][3] * 1 + output['scores'][4] * 0`

### Task 2: Solution Element Analyzer

**Type**: `vector.completion`

**System Prompt**: Expert pitch analyst evaluating SOLUTION description. Consider product descriptions, feature explanations, differentiation, demonstrations, and problem-solution fit.

**Responses** (5 levels, scored 4→0):
1. "Dominant: Solution description dominates with detailed mechanics, differentiation, and demonstrations"
2. "Strong: Solution is thoroughly explained with clear value proposition and differentiation"
3. "Moderate: Solution is described adequately but missing depth on mechanics or differentiation"
4. "Light: Solution is mentioned but not fully explained; raises more questions than answers"
5. "Absent: No clear solution described; pitch focuses on other elements"

### Task 3: Market Element Analyzer

**Type**: `vector.completion`

**System Prompt**: Expert pitch analyst evaluating MARKET opportunity quantification. Consider TAM/SAM/SOM, market sizing methodology, growth projections, segmentation, and competitive landscape.

**Responses** (5 levels, scored 4→0):
1. "Dominant: Extensive market analysis with rigorous sizing, segmentation, competitive mapping, and growth projections"
2. "Strong: Clear market quantification with reasonable methodology and competitive awareness"
3. "Moderate: Market size mentioned with some supporting data but limited depth"
4. "Light: Vague market references ('huge opportunity') without quantification"
5. "Absent: No market sizing or opportunity quantification"

### Task 4: Business Model Element Analyzer

**Type**: `vector.completion`

**System Prompt**: Expert pitch analyst evaluating BUSINESS MODEL clarity. Consider pricing models, revenue mechanics, unit economics, scalability, and path to profitability.

**Responses** (5 levels, scored 4→0):
1. "Dominant: Comprehensive business model with detailed unit economics, validated pricing, and clear profitability path"
2. "Strong: Clear revenue mechanics with pricing structure and basic economic logic"
3. "Moderate: Business model explained at high level but missing unit economics or validation"
4. "Light: Monetization mentioned vaguely without detail"
5. "Absent: No discussion of how the venture makes money"

### Task 5: Traction/Proof Element Analyzer

**Type**: `vector.completion`

**System Prompt**: Expert pitch analyst evaluating TRACTION and validation evidence. Consider quantitative metrics, customer proof, partnerships, milestones, and growth velocity.

**Responses** (5 levels, scored 4→0):
1. "Dominant: Extensive traction with compelling metrics, growth curves, customer proof, and validation milestones"
2. "Strong: Clear quantitative traction with meaningful metrics and supporting evidence"
3. "Moderate: Some traction shown but early-stage or limited in scope"
4. "Light: Minimal traction mentioned or only future projections"
5. "Absent: No traction evidence; pitch is entirely forward-looking"

### Task 6: Team/Execution Element Analyzer

**Type**: `vector.completion`

**System Prompt**: Expert pitch analyst evaluating TEAM credibility. Consider founder backgrounds, domain expertise, track records, complementary skills, and "why us" argumentation.

**Responses** (5 levels, scored 4→0):
1. "Dominant: Extensive team focus with detailed backgrounds, domain expertise, track record, and 'why us' argumentation"
2. "Strong: Team credentials clearly established with relevant experience and complementary skills"
3. "Moderate: Team mentioned with some background but limited depth or differentiation"
4. "Light: Team briefly referenced without meaningful credentialing"
5. "Absent: No team discussion"

### Task 7: Vision Element Analyzer

**Type**: `vector.completion`

**System Prompt**: Expert pitch analyst evaluating VISION articulation. Consider long-term vision statements, impact narratives, roadmaps, expansion plans, and purpose beyond financial returns.

**Responses** (5 levels, scored 4→0):
1. "Dominant: Compelling, expansive vision anchoring the narrative with clear long-term ambition and impact"
2. "Strong: Clear vision with authentic ambition and logical connection to current work"
3. "Moderate: Some vision present but limited in scope or disconnected from execution"
4. "Light: Brief aspirational statements without developed vision narrative"
5. "Absent: Purely tactical focus; no long-term vision articulation"

---

## Expressions to Write

### 1. User Content Expressions (for each task)

All 7 tasks use the same user content expression to pass the pitch:
```json
{
  "$starlark": "'Evaluate the [ELEMENT] element in this startup pitch:\\n\\n' + str(input['idea'])"
}
```

Where `[ELEMENT]` is replaced with: PROBLEM, SOLUTION, MARKET, BUSINESS MODEL, TRACTION/PROOF, TEAM/EXECUTION, or VISION.

### 2. Task Output Expressions (for each task)

Each task outputs a raw weighted score (0-4 scale):
```json
{
  "$starlark": "output['scores'][0] * 4 + output['scores'][1] * 3 + output['scores'][2] * 2 + output['scores'][3] * 1 + output['scores'][4] * 0"
}
```

This maps:
- Dominant → 4
- Strong → 3
- Moderate → 2
- Light → 1
- Absent → 0

### 3. Final Output Expression (vector.function level)

The function's output must normalize the 7 raw scores into a probability distribution summing to 1:

```json
{
  "$starlark": "[task_outputs[i] / sum(task_outputs) if sum(task_outputs) > 0 else 1/7 for i in range(7)]"
}
```

Or equivalently with explicit calculation:
```json
{
  "$starlark": "(lambda t, s: [t[i]/s if s > 0 else 1/7 for i in range(7)])(task_outputs, sum(task_outputs))"
}
```

This handles the edge case where all elements are absent (sum = 0) by returning uniform distribution.

---

## Test Inputs

### Test 1: Balanced, Complete Pitch
```json
{
  "idea": "The Problem: Small businesses lose $50B annually to invoice payment delays. 60% of invoices are paid late, causing cash flow crises that kill 82% of failed small businesses.\n\nOur Solution: PayFlow is an AI-powered invoicing platform that predicts payment likelihood and automatically triggers personalized follow-up sequences. Unlike generic invoicing tools, we use behavioral signals to optimize timing and messaging.\n\nThe Market: The $12B invoicing software market is growing 15% annually. We're targeting the 30M US small businesses, starting with professional services firms (accountants, lawyers, consultants) who invoice heavily.\n\nBusiness Model: SaaS subscription at $49/month for small businesses, $199/month for agencies. Current CAC is $120 with 14-month LTV of $588. 78% gross margin.\n\nTraction: 2,400 paying customers, $140K MRR, growing 18% month-over-month. NPS of 72. Customers include three Fortune 500 companies running pilots.\n\nTeam: CEO Jane Smith spent 10 years at Square leading payments products. CTO John Doe built the fraud detection system at Stripe. We've hired 15 engineers from Google and Meta.\n\nVision: We're building the financial nervous system for small business. PayFlow will expand from invoicing to full cash flow management, becoming the CFO-in-a-box that every small business deserves."
}
```
**Expected**: Relatively balanced distribution, all elements present with moderate-to-strong scores.

### Test 2: Problem-Heavy Early-Stage Pitch
```json
{
  "idea": "Every year, 1.3 million people die in car accidents globally. That's one death every 24 seconds. In the US alone, distracted driving causes 3,000 deaths annually—and the problem is getting worse as phones become more addictive.\n\nWe've talked to 200 families who lost loved ones to distracted driving. The pain is unimaginable. Insurance companies told us they pay out $40B annually for distracted driving claims. Fleet managers we interviewed said it's their #1 safety concern.\n\nThe technology exists to solve this. We're building a solution that uses computer vision to detect distraction and intervene before accidents happen. We're still in stealth but have provisional patents filed."
}
```
**Expected**: High Problem score, moderate Solution, low/absent Market/Business Model/Traction, some Team (implied), some Vision.

### Test 3: Traction-Dominated Growth-Stage Pitch
```json
{
  "idea": "We're growing 300% year-over-year. $5M ARR, up from $1.2M last year. 50,000 active users across 12 countries. Our enterprise contracts include Microsoft, Salesforce, and Amazon. Just closed a $20M Series B led by Sequoia. 140% net revenue retention. Customer acquisition cost dropped 40% this quarter while conversion rates doubled."
}
```
**Expected**: Very high Traction score, low/absent scores for most other elements.

### Test 4: Vision-Heavy Moonshot Pitch
```json
{
  "idea": "We're building the future of human longevity. Imagine a world where aging is optional—where your biological age can be reversed, where age-related diseases are eliminated, where humans live healthy lives for 150 years or more.\n\nThis isn't science fiction. The science of aging has advanced dramatically. We've identified 12 biological pathways that drive aging, and interventions exist for each. Our mission is to integrate these interventions into a comprehensive longevity protocol accessible to everyone.\n\nIn 10 years, we'll have clinics in every major city. In 20 years, longevity therapy will be as common as annual checkups. In 50 years, we'll look back at today's 80-year lifespans the way we look back at 19th-century medicine.\n\nThis is the most important problem humanity can solve. Everything else—climate, poverty, education—becomes easier when humans have more healthy years to contribute."
}
```
**Expected**: Very high Vision score, some Problem (implied), low/absent Solution specifics, Team, Traction, Business Model.

### Test 5: Technical Founder (Solution-Heavy)
```json
{
  "idea": "Our platform uses a novel transformer architecture optimized for tabular data. Unlike existing solutions that treat tables as images or sequences, we developed TabFormer—a purpose-built architecture that understands column semantics, data types, and relational structures natively.\n\nThe technical innovation is threefold: (1) Type-aware embeddings that encode numerical, categorical, and temporal columns differently; (2) Cross-column attention that captures feature interactions; (3) A new pre-training objective based on cell-level masking with type constraints.\n\nWe've benchmarked against XGBoost, LightGBM, and TabNet across 50 datasets. TabFormer achieves state-of-the-art on 43 of them, with average 12% improvement in AUC. Our inference latency is 3ms per batch of 1000 rows.\n\nThe system is implemented in PyTorch with custom CUDA kernels for the attention mechanism. We offer both cloud API and on-premise deployment. Integration requires 10 lines of code with our SDK."
}
```
**Expected**: Very high Solution score, low/absent Problem, Market, Business Model, Team, Vision, minimal Traction.

### Test 6: Image Input (Slide Deck Snapshot)
```json
{
  "idea": { "$image": "base64-encoded-pitch-deck-slide" }
}
```
**Expected**: Function should parse slide content and distribute scores based on what the slide emphasizes.

### Test 7: Minimal/Empty Pitch
```json
{
  "idea": "We're building something cool."
}
```
**Expected**: Very low scores across all elements, possibly uniform distribution after normalization.

### Test 8: Composite Multi-Slide Pitch
```json
{
  "idea": [
    "Slide 1: The Problem\nSmall restaurants lose 30% of revenue to food waste.",
    "Slide 2: Our Solution\nAI-powered demand forecasting that reduces waste by 50%.",
    "Slide 3: The Market\n$900B restaurant industry, $300B food waste problem.",
    { "$image": "base64-traction-chart" },
    "Slide 5: The Team\nFormer Uber Eats and DoorDash engineers."
  ]
}
```
**Expected**: Function should aggregate across all slides/elements and produce coherent distribution.

### Test 9: Business Model Focus (SaaS Metrics Pitch)
```json
{
  "idea": "Our pricing: $99/month Starter, $299/month Pro, $999/month Enterprise. Current metrics: $800K ARR, 85% gross margin, $450 CAC, $5,400 LTV, 12:1 LTV/CAC ratio. We achieve payback in 4 months. Expansion revenue from upsells drives 130% net retention. Our unit economics support aggressive growth—every $1 in sales and marketing returns $4 in customer lifetime value."
}
```
**Expected**: High Business Model and Traction scores, low other elements.

### Test 10: Team-Centric Pitch
```json
{
  "idea": "We are the team that built Stripe's core payments infrastructure. Our CEO, Sarah Chen, scaled Stripe from $1B to $50B in payment volume. Our CTO, Marcus Johnson, architected the system that processes 500M API calls daily. Our VP of Sales, Lisa Park, built Stripe's enterprise sales team from 5 to 200 people.\n\nBetween us, we have 4 successful exits, 3 patents in payment processing, and 50 years of combined experience in fintech. We've recruited 8 senior engineers from Stripe, Square, and Plaid. Our advisors include the founders of Brex and Ramp.\n\nWe know this space better than anyone. We've seen every failure mode. We know exactly what to build and how to sell it."
}
```
**Expected**: Very high Team score, low/absent other elements.

---

## Edge Cases to Handle

1. **All elements absent**: Division by zero in normalization → return uniform [1/7, 1/7, ...]
2. **Single dominant element**: All weight should concentrate there
3. **Non-English pitches**: Should still extract structural elements
4. **Very short pitches**: May lack multiple elements; should not artificially inflate scores
5. **Mixed-format composite input**: Must aggregate coherently across text, images, audio, video
6. **Boundary cases**: Content that straddles elements (e.g., "The team solved this problem at Google" → both Team and Problem)

---

## Output Format

The function returns a 7-element array representing the probability distribution:

```json
[
  0.18,  // Problem
  0.22,  // Solution
  0.12,  // Market
  0.10,  // Business Model
  0.15,  // Traction/Proof
  0.13,  // Team/Execution
  0.10   // Vision
]
```

Sum = 1.0 (within floating-point tolerance)

The order is fixed and corresponds to:
1. Problem
2. Solution
3. Market
4. Business Model
5. Traction/Proof
6. Team/Execution
7. Vision
