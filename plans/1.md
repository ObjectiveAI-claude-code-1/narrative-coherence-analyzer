# Implementation Plan: Narrative Coherence Analyzer

## Overview

The Narrative Coherence Analyzer is a **vector function** that analyzes startup pitches and outputs a 7-element probability distribution representing the relative strength of each canonical narrative element. The output vector sums to 1.0.

---

## Input Schema

```json
{
  "type": "object",
  "description": "A startup pitch to analyze for narrative coherence across the seven canonical elements: Problem, Solution, Market, Business Model, Traction, Team, and Vision.",
  "properties": {
    "idea": {
      "anyOf": [
        {
          "type": "string",
          "description": "A text-based startup pitch (elevator pitch, executive summary, pitch script, etc.)"
        },
        {
          "type": "image",
          "description": "An image-based pitch (pitch deck slide, infographic, one-pager)"
        },
        {
          "type": "audio",
          "description": "An audio pitch (recorded elevator pitch, podcast clip)"
        },
        {
          "type": "video",
          "description": "A video pitch (demo day recording, pitch video, product demo)"
        },
        {
          "type": "array",
          "items": {
            "anyOf": [
              { "type": "string" },
              { "type": "image" },
              { "type": "audio" },
              { "type": "video" }
            ]
          },
          "description": "A composite pitch containing multiple elements (e.g., pitch deck slides + founder video)"
        }
      ]
    }
  },
  "required": ["idea"]
}
```

### Input Maps

**No input maps needed.** All 7 tasks evaluate the same input (`idea`). There is no mapped task execution required—each task runs once against the full pitch content.

---

## Function Definition Structure

```json
{
  "type": "vector.function",
  "description": "Analyze the narrative structure of a startup pitch, producing a 7-element probability distribution over the canonical narrative elements: Problem, Solution, Market, Business Model, Traction, Team, and Vision. Higher scores indicate stronger presence and quality of that element. Scores sum to 1.0, revealing relative emphasis and identifying gaps.",
  "input_schema": { ... },
  "tasks": [
    // Task 1: Problem Strength
    // Task 2: Solution Strength
    // Task 3: Market Strength
    // Task 4: Business Model Strength
    // Task 5: Traction Strength
    // Task 6: Team Strength
    // Task 7: Vision Strength
  ]
}
```

---

## Task Definitions

Each task is a `vector.completion` that evaluates one narrative element using a 5-level response scale.

### Task 1: Problem Strength Evaluation

**System Prompt:**
```
You are an expert startup pitch analyst evaluating the PROBLEM articulation in a startup pitch.

Assess:
- PRESENCE: Is the problem explicitly stated, implied, or absent?
- SPECIFICITY: Is the problem concrete and measurable, or vague and abstract?
- MAGNITUDE: Does it represent significant pain (widespread or acute)?
- URGENCY: Does it demand immediate attention?
- CREDIBILITY: Are claims supported by data or obvious observation?
- EMOTIONAL RESONANCE: Does the audience feel the pain?

Evaluate the overall strength of the problem articulation. Choose the single best answer.
```

**User Content:** `"Evaluate the PROBLEM articulation in this startup pitch:\n\n" + str(input['idea'])`

**Responses (5-level):**
1. "Exceptional: Problem is explicit, specific, large in magnitude, urgent, credible, and emotionally resonant"
2. "Strong: Problem is clearly articulated with most quality dimensions present"
3. "Moderate: Problem is present but lacks specificity, magnitude, or credibility"
4. "Weak: Problem is vaguely implied or only partially addressed"
5. "Absent: No problem articulation; pitch jumps directly to solution or other elements"

**Output Expression:** `output['scores'][0] * 1.0 + output['scores'][1] * 0.75 + output['scores'][2] * 0.5 + output['scores'][3] * 0.25 + output['scores'][4] * 0.0`

---

### Task 2: Solution Strength Evaluation

**System Prompt:**
```
You are an expert startup pitch analyst evaluating the SOLUTION articulation in a startup pitch.

Assess:
- PRESENCE: Is the solution explicitly described or unclear?
- CLARITY: Can the audience understand what it does without jargon?
- PROBLEM-SOLUTION FIT: Does it directly address the stated problem?
- DEFENSIBILITY: Is it clear why this is better than alternatives?
- ELEGANCE: Does it feel like a natural response to the problem?
- FEASIBILITY: Is it buildable with current technology?

Evaluate the overall strength of the solution articulation. Choose the single best answer.
```

**User Content:** `"Evaluate the SOLUTION articulation in this startup pitch:\n\n" + str(input['idea'])`

**Responses (5-level):**
1. "Exceptional: Solution is crystal clear, directly addresses the problem, defensible, elegant, and feasible"
2. "Strong: Solution is well-articulated with clear problem-solution fit"
3. "Moderate: Solution is present but lacks clarity, defensibility, or clear connection to problem"
4. "Weak: Solution is vague, overly complex, or poorly connected to stated problem"
5. "Absent: No clear solution articulation"

**Output Expression:** `output['scores'][0] * 1.0 + output['scores'][1] * 0.75 + output['scores'][2] * 0.5 + output['scores'][3] * 0.25 + output['scores'][4] * 0.0`

---

### Task 3: Market Strength Evaluation

**System Prompt:**
```
You are an expert startup pitch analyst evaluating the MARKET articulation in a startup pitch.

Assess:
- PRESENCE: Is market size explicitly stated (TAM/SAM/SOM), implied, or absent?
- CREDIBILITY: Are figures from credible sources? Bottoms-up > top-down.
- SPECIFICITY: Is the target market clearly defined or vaguely "everyone"?
- ACCESSIBILITY: Can the startup actually reach this market?
- DYNAMICS: Are growth trends or timing considerations addressed?
- SEGMENTATION: Is there a clear entry wedge and understanding of heterogeneity?

Evaluate the overall strength of the market articulation. Choose the single best answer.
```

**User Content:** `"Evaluate the MARKET articulation in this startup pitch:\n\n" + str(input['idea'])`

**Responses (5-level):**
1. "Exceptional: Market is precisely sized with credible methodology, clearly segmented, accessible, with favorable dynamics"
2. "Strong: Market is well-defined with reasonable sizing and clear target segment"
3. "Moderate: Market is mentioned but sizing is vague, top-down, or unsupported"
4. "Weak: Market is briefly implied without sizing or segmentation"
5. "Absent: No market information provided"

**Output Expression:** `output['scores'][0] * 1.0 + output['scores'][1] * 0.75 + output['scores'][2] * 0.5 + output['scores'][3] * 0.25 + output['scores'][4] * 0.0`

---

### Task 4: Business Model Strength Evaluation

**System Prompt:**
```
You are an expert startup pitch analyst evaluating the BUSINESS MODEL articulation in a startup pitch.

Assess:
- PRESENCE: Is the business model explicitly described or deferred?
- CLARITY: Is it clear how money flows—who pays whom, for what, when?
- ALIGNMENT: Does the model align incentives with customers?
- SCALABILITY: Can it grow without proportional cost increases?
- DEFENSIBILITY: Does it create switching costs or moats?
- CREDIBILITY: Are pricing assumptions realistic?

Evaluate the overall strength of the business model articulation. Choose the single best answer.
```

**User Content:** `"Evaluate the BUSINESS MODEL articulation in this startup pitch:\n\n" + str(input['idea'])`

**Responses (5-level):**
1. "Exceptional: Business model is crystal clear, scalable, defensible, and well-aligned with customer value"
2. "Strong: Business model is clearly articulated with reasonable unit economics"
3. "Moderate: Business model is mentioned but lacks detail on pricing, margins, or scalability"
4. "Weak: Business model is vaguely implied or deferred ('focused on growth first')"
5. "Absent: No business model information provided"

**Output Expression:** `output['scores'][0] * 1.0 + output['scores'][1] * 0.75 + output['scores'][2] * 0.5 + output['scores'][3] * 0.25 + output['scores'][4] * 0.0`

---

### Task 5: Traction/Proof Strength Evaluation

**System Prompt:**
```
You are an expert startup pitch analyst evaluating the TRACTION and PROOF in a startup pitch.

Assess:
- PRESENCE: Is traction quantified (revenue, users, growth), implied (logos), or absent?
- RELEVANCE: Do the metrics matter for this business? (engagement/revenue > vanity)
- MAGNITUDE: Are numbers impressive for the stage?
- TRAJECTORY: What is the growth rate?
- QUALITY: Quality of customers (enterprise logos, high-value contracts)?
- RECENCY: Is the traction current or outdated?

Evaluate the overall strength of the traction/proof. Choose the single best answer.
```

**User Content:** `"Evaluate the TRACTION and PROOF in this startup pitch:\n\n" + str(input['idea'])`

**Responses (5-level):**
1. "Exceptional: Strong, relevant metrics with impressive magnitude, clear growth trajectory, and quality customers"
2. "Strong: Clear traction with meaningful metrics and positive trajectory"
3. "Moderate: Some traction mentioned but metrics are limited, dated, or less relevant"
4. "Weak: Minimal proof points—waitlist signups, letters of intent, or pilot discussions"
5. "Absent: No traction or proof provided (pre-launch with no validation)"

**Output Expression:** `output['scores'][0] * 1.0 + output['scores'][1] * 0.75 + output['scores'][2] * 0.5 + output['scores'][3] * 0.25 + output['scores'][4] * 0.0`

---

### Task 6: Team/Execution Strength Evaluation

**System Prompt:**
```
You are an expert startup pitch analyst evaluating the TEAM and EXECUTION credibility in a startup pitch.

Assess:
- PRESENCE: Are team credentials explicitly listed or absent?
- RELEVANT EXPERIENCE: Domain expertise, prior startup experience, technical skills?
- TRACK RECORD: Have they built/shipped products? Worked together?
- FOUNDER-MARKET FIT: Why is this team uniquely positioned?
- COMPLETENESS: Are key capabilities covered (technical, commercial, operational)?
- COMMITMENT: Full-time and all-in, or side project?

Evaluate the overall strength of the team/execution credibility. Choose the single best answer.
```

**User Content:** `"Evaluate the TEAM and EXECUTION credibility in this startup pitch:\n\n" + str(input['idea'])`

**Responses (5-level):**
1. "Exceptional: Team has exceptional relevant experience, proven track record, strong founder-market fit, and complete capabilities"
2. "Strong: Team credentials are clear with relevant experience and demonstrated ability"
3. "Moderate: Team is mentioned but credentials are limited or relevance is unclear"
4. "Weak: Team is briefly referenced without meaningful credential information"
5. "Absent: No team information provided"

**Output Expression:** `output['scores'][0] * 1.0 + output['scores'][1] * 0.75 + output['scores'][2] * 0.5 + output['scores'][3] * 0.25 + output['scores'][4] * 0.0`

---

### Task 7: Vision Strength Evaluation

**System Prompt:**
```
You are an expert startup pitch analyst evaluating the VISION articulation in a startup pitch.

Assess:
- PRESENCE: Is vision explicitly articulated or absent?
- AMBITION: Is it big enough to be exciting and inspiring?
- PLAUSIBILITY: Is there a credible path from current state to the vision?
- SPECIFICITY: Is it concrete enough to be actionable?
- DIFFERENTIATION: Does it describe a future only this company can create?
- EMOTIONAL RESONANCE: Does it create excitement and buy-in?

Evaluate the overall strength of the vision articulation. Choose the single best answer.
```

**User Content:** `"Evaluate the VISION articulation in this startup pitch:\n\n" + str(input['idea'])`

**Responses (5-level):**
1. "Exceptional: Vision is ambitious, plausible, specific, differentiated, and emotionally compelling"
2. "Strong: Vision is clearly articulated with meaningful ambition and plausible path"
3. "Moderate: Vision is present but generic, vague, or disconnected from current work"
4. "Weak: Vision is briefly implied without meaningful articulation"
5. "Absent: No vision provided; pitch is purely tactical/immediate"

**Output Expression:** `output['scores'][0] * 1.0 + output['scores'][1] * 0.75 + output['scores'][2] * 0.5 + output['scores'][3] * 0.25 + output['scores'][4] * 0.0`

---

## Output Aggregation

The function type is `vector.function`, which means the 7 task outputs are collected into a vector and automatically normalized to sum to 1.0.

**Output Vector Order:**
```
[problem, solution, market, business_model, traction, team, vision]
```

Each position corresponds to the strength of that narrative element.

---

## Expressions Summary

All expressions use `$starlark` syntax:

### User Content Expressions (all 7 tasks)
```starlark
"Evaluate the [ELEMENT] in this startup pitch:\n\n" + str(input['idea'])
```

### Output Expressions (all 7 tasks)
```starlark
output['scores'][0] * 1.0 + output['scores'][1] * 0.75 + output['scores'][2] * 0.5 + output['scores'][3] * 0.25 + output['scores'][4] * 0.0
```

This weighted sum converts the 5-level response probabilities into a scalar score from 0.0 to 1.0.

---

## Test Inputs

### 1. Comprehensive Pitch (All Elements Strong)
```json
{
  "idea": "We're solving the $50B annual problem of restaurant food waste. 40% of food purchased by restaurants is thrown away due to poor demand forecasting. Our AI-powered inventory management system analyzes historical sales, weather, events, and local trends to predict demand with 95% accuracy, reducing waste by 40% on average. We target the 660,000 full-service restaurants in the US, a $15B addressable market. We charge $299/month per location with 80% gross margins. We have 50 paying restaurant customers generating $180K ARR, growing 25% month-over-month, including Michelin-starred restaurants in NYC and SF. Our founding team includes ex-Google ML engineers and a former VP of Operations at Sysco with 15 years in food service. Our vision: eliminate food waste globally, starting with restaurants, then expanding to grocers, hotels, and institutional food service."
}
```
**Expected Output:** Relatively balanced distribution with all elements ~0.12-0.16

### 2. Problem-Only Pitch
```json
{
  "idea": "Food waste is a $50 billion problem in the restaurant industry. Every year, 40% of food purchased by restaurants ends up in the trash. This isn't just an economic problem—it's an environmental disaster contributing to 8% of global greenhouse gas emissions. Restaurateurs feel the pain every time they throw away spoiled produce."
}
```
**Expected Output:** Heavy on problem (~0.7+), near-zero on other elements

### 3. Solution-Focused Pitch (Missing Problem)
```json
{
  "idea": "Our AI platform uses machine learning to analyze point-of-sale data, weather patterns, local events, and historical trends to generate precise demand forecasts. The system integrates directly with existing POS systems and provides real-time inventory recommendations through a mobile app. Our proprietary algorithms have been trained on 50 million transactions."
}
```
**Expected Output:** Heavy on solution, low on problem (jumped straight to how)

### 4. Traction-Heavy Pitch
```json
{
  "idea": "We launched 6 months ago and already have $500K ARR from 200 paying customers. We're growing 30% month-over-month with 95% retention. Our customers include Fortune 500 companies like Walmart, Target, and Costco. We just closed a $2M pilot with the largest restaurant chain in North America."
}
```
**Expected Output:** Heavy on traction, light on problem/solution/vision

### 5. Visionary Pitch (Light on Execution)
```json
{
  "idea": "Imagine a world where no food is ever wasted. Where every restaurant, grocery store, and home knows exactly what they need and when. We're building the operating system for the global food supply chain—a platform that will eliminate the $1 trillion annual cost of food waste and feed 800 million hungry people with food that would otherwise be thrown away. This is the future we're building."
}
```
**Expected Output:** Heavy on vision, light on traction/team/business model

### 6. Pre-Launch Pitch (No Traction)
```json
{
  "idea": "Restaurants waste 40% of their food due to poor forecasting. We're building an AI system that predicts demand accurately. The market is $15B in the US alone. We'll charge $299/month per location. Our team is three MIT computer science PhDs who previously built predictive systems at Amazon. We envision a zero-waste restaurant industry within 10 years."
}
```
**Expected Output:** Zero traction, moderate/strong on other elements

### 7. Empty/Minimal Pitch
```json
{
  "idea": "We're a food tech startup."
}
```
**Expected Output:** All elements weak/absent, relatively uniform low distribution

### 8. Team-Focused Pitch
```json
{
  "idea": "Our founding team has 50 combined years of experience in the restaurant industry. Our CEO previously founded and sold two restaurant technology companies for a combined $200M. Our CTO built the recommendation engine at DoorDash. Our COO ran operations for a 500-location restaurant chain. We've worked together for 10 years and have a deep passion for solving restaurant problems."
}
```
**Expected Output:** Heavy on team, light on problem/solution/specifics

### 9. Market-Focused Pitch
```json
{
  "idea": "The global restaurant technology market is $45B and growing 15% annually. In the US alone, there are 660,000 full-service restaurants spending an average of $15,000/year on technology. The food waste segment is particularly underserved, with only 2% of restaurants using any forecasting tools. Our TAM is $15B, SAM is $2B, and initial SOM is $50M targeting premium restaurants in major metros."
}
```
**Expected Output:** Heavy on market, light on solution/traction

### 10. Multimodal Pitch (Composite Array)
```json
{
  "idea": [
    "Slide 1: The Problem - 40% of restaurant food is wasted",
    "Slide 2: Our Solution - AI-powered demand forecasting",
    "Slide 3: Market Size - $15B TAM",
    "Slide 4: Traction - 50 customers, $180K ARR",
    "Slide 5: Team - Ex-Google, Ex-Sysco",
    "Slide 6: Vision - Zero food waste globally"
  ]
}
```
**Expected Output:** Balanced distribution across elements

### 11. Business Model Focus
```json
{
  "idea": "We charge restaurants $299/month per location with no setup fees. Our unit economics: CAC is $500, LTV is $7,200, giving us 14x LTV:CAC ratio. We have 80% gross margins. Revenue is 100% recurring with annual contracts. We upsell premium analytics for $199/month and enterprise API access for $999/month. Our path to profitability is 18 months away."
}
```
**Expected Output:** Heavy on business model, light on problem/vision

### 12. Disconnected Elements (Poor Coherence)
```json
{
  "idea": "There's a huge problem with pet obesity. Our AI predicts restaurant demand. The market for blockchain is $50B. We charge monthly subscriptions. We have 10 users. Our team is from Harvard. We'll change the world."
}
```
**Expected Output:** Low scores across all elements (elements present but disconnected/weak)

---

## Edge Case Handling

1. **Empty input**: All tasks produce Absent scores → uniform distribution after normalization
2. **Single media types**: Images, video, audio should work with same prompts via str() conversion
3. **Composite arrays**: All elements considered together as unified narrative
4. **Non-English pitches**: Should still evaluate presence/quality of elements
5. **Extremely long pitches**: Model handles naturally; no special truncation needed

---

## Implementation Checklist

- [ ] Define input schema with anyOf for multimodal support
- [ ] Implement 7 vector.completion tasks
- [ ] Configure 5-level response scales for each task
- [ ] Add weighted output expressions to convert to 0-1 scores
- [ ] Verify vector.function type handles normalization automatically
- [ ] Test with all 12 test cases
- [ ] Validate output vector sums to 1.0
